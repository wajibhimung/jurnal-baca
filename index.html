<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Jurnal Baca TKJ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
      :root { --primary-color: #6a11cb; --secondary-color: #2575fc; }
      body { font-family: 'Poppins', sans-serif; background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); color: #333; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
      .loader-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 9999; }
      .login-card { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; color: white; box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37); width: 100%; max-width: 450px; }
      .form-control, .form-select { background-color: rgba(255, 255, 255, 0.2) !important; border: none !important; color: white !important; }
      .form-control::placeholder { color: #ddd; }
      .form-floating > label { color: #ddd !important; }
      .btn-primary { background-image: linear-gradient(45deg, #f83292, #ff6b08); border: none; transition: all 0.3s ease; }
      .btn-primary:hover { transform: scale(1.05); }
    </style>
</head>
<body>
    <div id="loader" class="loader-wrapper"><div class="spinner-border text-light" role="status"></div></div>
    <div class="card login-card">
        <div class="card-body p-5">
            <h2 class="card-title text-center mb-4">Jurnal Baca TKJ</h2>
            <form id="loginForm">
                <div class="form-floating mb-3"><input type="email" class="form-control" id="email" placeholder="name@example.com" required><label for="email">Email</label></div>
                <div class="form-floating mb-3"><input type="password" class="form-control" id="password" placeholder="Password" required><label for="password">Password</label></div>
                <div class="form-floating mb-4"><select class="form-select" id="role" required><option value="siswa" selected>Siswa</option><option value="guru">Guru</option></select><label for="role">Login sebagai</label></div>
                <div class="d-grid"><button type="submit" class="btn btn-primary btn-lg">Login</button></div>
                <div id="login-alert" class="alert alert-danger mt-3 d-none" role="alert"></div>
            </form>
        </div>
    </div>
<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxHVip9ojPg5rHfua-rql-L3fGoEvKW5slm8QKkbCof3llSolsYUvBO_h0jTohBFG-unA/exec";
    const loginForm = document.getElementById('loginForm');
    const loader = document.getElementById('loader');
    const loginAlert = document.getElementById('login-alert');
    document.addEventListener('DOMContentLoaded', () => {
        const user = sessionStorage.getItem('currentUser');
        if(user) {
            const userData = JSON.parse(user);
            if(userData.role === 'siswa') window.location.href = 'siswa.html';
            if(userData.role === 'guru') window.location.href = 'guru.html';
        }
    });
    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        loader.style.display = 'flex';
        loginAlert.classList.add('d-none');
        const payload = { action: "login", data: { email: document.getElementById('email').value, password: document.getElementById('password').value, role: document.getElementById('role').value } };
        try {
            const response = await fetch(API_URL, { method: 'POST', headers: { 'Content-Type': 'text/plain;charset=utf-8' }, body: JSON.stringify(payload), redirect: "follow" });
            const result = await response.json();
            if (result.status === 'success' && result.data.status === 'success') {
                sessionStorage.setItem('currentUser', JSON.stringify(result.data));
                if (result.data.role === 'siswa') { window.location.href = 'siswa.html'; } else { window.location.href = 'guru.html'; }
            } else {
                const message = result.data.message || result.message || 'Terjadi kesalahan.';
                loginAlert.textContent = message;
                loginAlert.classList.remove('d-none');
            }
        } catch (error) {
            loginAlert.textContent = "Tidak dapat terhubung ke server. " + error;
            loginAlert.classList.remove('d-none');
        } finally {
            loader.style.display = 'none';
        }
    });
</script>
</body>
</html>