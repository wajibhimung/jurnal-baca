<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Meta SEO Tags -->
    <title>Jurnal Baca Digital - Kelas TKJ SMKN 1 Telagasari</title>
    <meta name="description" content="Jadi pembaca terbaik di kelas TKJ SMKN 1 Telagasari! Gunakan Jurnal Baca Digital ini untuk mencatat semua buku keren yang kamu baca, naikkan peringkatmu, dan buktikan semangat literasimu.">
    <meta name="keywords" content="jurnal baca, literasi digital, tkj, smkn 1 telagasari, aplikasi pendidikan, jurnal siswa">
    <meta name="author" content="Kelas TKJ SMKN 1 Telagasari">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: rgba(255, 255, 255, 0.1);
            --text-light: #f8f9fa;
            --text-muted-light: #adb5bd;
            --input-bg: rgba(255, 255, 255, 0.15);
            --btn-gradient: linear-gradient(90deg, #ff85b1 0%, #ffc107 100%);
        }
        body { 
            font-family: 'Poppins', sans-serif; 
            background: var(--bg-gradient); 
            color: var(--text-light); 
            display: flex; 
            flex-direction: column; 
            min-height: 100vh;
            opacity: 0;
            animation: fadeIn 1s ease-out forwards;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        main { flex: 1; display: flex; align-items: center; justify-content: center; padding: 2rem 0; }
        .loader-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: none; justify-content: center; align-items: center; z-index: 1080; }
        .login-container { width: 100%; max-width: 900px; }
        .login-hero { display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding-right: 2rem; }
        .login-hero img { max-width: 80%; margin-bottom: 1rem; }
        .login-card { 
            background: var(--card-bg); 
            backdrop-filter: blur(15px); 
            border: 1px solid rgba(255, 255, 255, 0.2); 
            border-radius: 20px; 
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            transform: translateY(20px);
            opacity: 0;
            animation: slideUpFadeIn 0.8s ease-out 0.5s forwards;
        }
        @keyframes slideUpFadeIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .input-group { position: relative; }
        .form-icon { position: absolute; top: 50%; left: 15px; transform: translateY(-50%); color: var(--text-muted-light); pointer-events: none; z-index: 3; }
        .password-toggle-icon { 
            position: absolute; 
            top: 50%; 
            right: 0; 
            transform: translateY(-50%); 
            color: var(--text-muted-light); 
            cursor: pointer; 
            z-index: 3;
            width: 50px; /* Area klik lebih besar */
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .form-control, .form-select { 
            background-color: var(--input-bg) !important; 
            border: 1px solid rgba(255, 255, 255, 0.2) !important; 
            color: var(--text-light) !important; 
            border-radius: 10px; 
            padding-left: 45px; 
            height: 50px; 
        }
        .form-control::placeholder { color: var(--text-muted-light); }
        .form-select { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23adb5bd' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e"); }
        .btn-login { background-image: var(--btn-gradient); border: none; font-weight: 600; border-radius: 10px; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .btn-login:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        .footer { background: transparent; color: rgba(255, 255, 255, 0.7); padding: 1rem 0; text-align: center; flex-shrink: 0; }
        .toast-container { z-index: 1090; }
        /* PERBAIKAN: Atur warna teks di dalam toast body */
        .toast-body {
            color: #343a40; /* Warna teks gelap agar kontras */
        }
        @media (max-width: 767.98px) { .login-hero { display: none; } .login-container { padding: 0 15px; } }
    </style>
</head>
<body>
    <div id="loader" class="loader-wrapper"><div class="spinner-border text-light" style="width: 3rem; height: 3rem;" role="status"></div></div>
    
    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="appToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="fas rounded me-2"></i>
                <strong class="me-auto" id="toastTitle"></strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastBody"></div>
        </div>
    </div>

    <main>
        <div class="container login-container">
            <div class="row align-items-center">
                <div class="col-md-6 login-hero">
                    <img src="https://cdni.iconscout.com/illustration/premium/thumb/reading-book-3488545-2922432.png" alt="Ilustrasi Membaca Buku" class="img-fluid">
                    <h1 class="fw-bold">Jurnal Baca Digital</h1>
                    <p class="text-white-50">Platform literasi modern untuk siswa TKJ SMKN 1 Telagasari.</p>
                </div>
                <div class="col-md-6">
                    <div class="card login-card">
                        <div class="card-body p-5">
                            <h2 class="card-title text-center mb-4 fw-bold">Login Akun Anda</h2>
                            <form id="loginForm" novalidate>
                                <div class="input-group mb-3">
                                    <i class="fas fa-envelope form-icon"></i>
                                    <input type="email" class="form-control" id="email" placeholder="Email" required>
                                </div>
                                <div class="input-group mb-3">
                                    <i class="fas fa-lock form-icon"></i>
                                    <input type="password" class="form-control" id="password" placeholder="Password" required>
                                    <!-- PERBAIKAN: ikon mata sekarang berada di dalam div yang lebih besar agar mudah diklik -->
                                    <div class="password-toggle-icon" id="togglePassword">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                </div>
                                <div class="input-group mb-4">
                                    <i class="fas fa-users form-icon"></i>
                                    <select class="form-select" id="role" required>
                                        <option value="siswa" selected>Login sebagai Siswa</option>
                                        <option value="guru">Login sebagai Guru</option>
                                    </select>
                                </div>
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-login text-white btn-lg">LOGIN</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer class="footer"> Dibuat dengan <i class="fas fa-heart text-danger"></i> untuk Kelas TKJ SMKN 1 Telagasari Â© 2025</footer>
    
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxHVip9ojPg5rHfua-rql-L3fGoEvKW5slm8QKkbCof3llSolsYUvBO_h0jTohBFG-unA/exec";
    const loginForm = document.getElementById('loginForm');
    const loader = document.getElementById('loader');
    const appToast = new bootstrap.Toast(document.getElementById('appToast'));

    function showToast(message, title = 'Gagal', type = 'danger') {
        const toastEl = document.getElementById('appToast');
        const titleEl = document.getElementById('toastTitle');
        const bodyEl = document.getElementById('toastBody');
        const iconEl = toastEl.querySelector('.toast-header i');
        const headerEl = toastEl.querySelector('.toast-header');
        const closeBtn = toastEl.querySelector('.btn-close');

        // Reset classes
        headerEl.classList.remove('bg-success', 'bg-danger', 'text-white');
        closeBtn.classList.remove('btn-close-white');
        iconEl.classList.remove('fa-check-circle', 'fa-times-circle');
        
        if(type === 'success') {
            headerEl.classList.add('bg-success', 'text-white');
            closeBtn.classList.add('btn-close-white');
            iconEl.classList.add('fa-check-circle');
        } else { // 'danger'
            headerEl.classList.add('bg-danger', 'text-white');
            closeBtn.classList.add('btn-close-white');
            iconEl.classList.add('fa-times-circle');
        }
        
        titleEl.textContent = title;
        bodyEl.textContent = message;
        appToast.show();
    }

    // Cek jika sudah login, redirect
    document.addEventListener('DOMContentLoaded', () => {
        const user = sessionStorage.getItem('currentUser');
        if(user) {
            const userData = JSON.parse(user);
            if(userData.role === 'siswa') window.location.href = 'siswa.html';
            if(userData.role === 'guru') window.location.href = 'guru.html';
        }

        // PERBAIKAN: Event listener untuk toggle password
        const togglePasswordContainer = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');
        const eyeIcon = togglePasswordContainer.querySelector('i'); // Targetkan ikon di dalamnya

        togglePasswordContainer.addEventListener('click', function () {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            
            // Ganti ikon mata
            eyeIcon.classList.toggle('fa-eye');
            eyeIcon.classList.toggle('fa-eye-slash');
        });
    });

    // Handle form submit
    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        if (!email || !password) {
            showToast('Email dan Password tidak boleh kosong.');
            return;
        }

        loader.style.display = 'flex';
        
        const payload = {
            action: "login",
            data: { email, password, role: document.getElementById('role').value }
        };

        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify(payload),
                redirect: "follow"
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const result = await response.json();

            if (result.status === 'success' && result.data.status === 'success') {
                sessionStorage.setItem('currentUser', JSON.stringify(result.data));
                window.location.href = result.data.role === 'siswa' ? 'siswa.html' : 'guru.html';
            } else {
                const message = result.data?.message || result.message || 'Terjadi kesalahan saat login.';
                showToast(message);
            }
        } catch (error) {
            console.error("Login Error:", error);
            showToast("Gagal terhubung ke server. Periksa koneksi internet Anda.");
        } finally {
            loader.style.display = 'none';
        }
    });
</script>
</body>
</html>